<button id="openPopupBtn" class="openPopupBtn">Address Change</button>
<div id="popUpBtn" class="popupBtnWindow">
  <div class="popupBtnWindow-content">
    <div class="popupBtnWindow-header">
      <h2>Address Converter</h2>
    </div>
    <div class="popupBtnWindow-body">
      <p>This feature changes the task's address from physical to coordinates and vice versa.</p>
      <button onclick="convertAddress()">Convert</button>
    </div>
    <button id="closeWindowBtn" class="closeWindowBtn">Close Window</button>
  </div>
</div>

{% include 'AppCalendar/switchAddress.html' %}
<script>
  document.addEventListener("DOMContentLoaded", function() {
    var openPopupBtn = document.getElementById('openPopupBtn');
    var popupWindow = document.getElementById('popUpBtn');
    var closeWindowBtn = document.getElementById('closeWindowBtn');

    openPopupBtn.addEventListener('click', function(event) {
        event.preventDefault();
        popupWindow.style.display = "block";
    });

    closeWindowBtn.addEventListener('click', function() {
      popupWindow.style.display = 'none';
      window.location.href='{% url "AppCalendar:SwitchAddress" %}';
    });
  });
  function convertAddress() {
  var addressInput = document.getElementById('addressInput');
  var address = addressInput.value;
  var location; 

  // Call a backend function to convert address to latitude and longitude
  // You can use AJAX to send the address to the backend
  // For simplicity, let's assume you have a function called 'convertAddressToLatLon' in your backend
  // Replace 'your_backend_url' with the actual URL where your backend is hosted
  geolocator = Nominatim(user_agent="AppCalendar")
    try:
        location = geolocator.geocode(task.address)
        if ',' in location:
       location = "Address";
    
    # Check if the location is coordinates
    parts = location.split()
    if len(parts) == 2:
        try:
            float(parts[0])
            float(parts[1])
           location = "Coordinates";
        except ValueError:
            pass
    
    # If neither address nor coordinates
   location = "Neither";

  if(location == 'address'){
  fetch('AppCalendar/switchAddress.html/convert_address', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ address: address }),
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      // Handle successful conversion (data.latitude, data.longitude)
      alert(`Latitude: ${data.latitude}, Longitude: ${data.longitude}`);
    } else {
      // Handle conversion failure
      alert('Failed to convert address to coordinates.');
    }
       // Close the pop-up
    closePopup();
  })
  }
  elif(location == 'address'){
      fetch('your_backend_url/convert_coordinates', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ latitude: latitude, longitude: longitude }),
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      // Handle successful conversion (data.address)
      alert(`Address: ${data.address}`);
    } else {
      // Handle conversion failure
      alert('Failed to convert coordinates to address.');
    }

    // Close the pop-up
    closePopup();
  })
    }
    else
    {
      #nothing
    }
  
    // Close the pop-up
    closePopup();
  })
  .catch(error => {
    console.error('Error:', error);
    alert('An error occurred while converting address.');
  });
}
</script>
